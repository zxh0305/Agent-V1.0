# 智能任务处理 Agent 平台 V2.0

## 项目简介

智能任务处理 Agent 平台是一个轻量级、可本地运行的智能 Agent 系统，专为学生科研和学习场景设计。用户通过输入自然语言任务，系统自动进行任务拆解规划，调用预设工具执行，并整合返回结果。

### 核心特点

- **自然语言交互**：支持用户使用自然语言描述任务
- **智能任务规划**：自动将复杂任务拆分为可执行的子步骤
- **工具调用引擎**：内置8个学生高频工具，支持灵活扩展
- **可视化界面**：基于 Streamlit 的友好 Web 界面
- **完全本地运行**：无需云服务，保护数据隐私
- **会话历史管理**：支持多轮对话上下文记忆
- **任务重试机制**：自动重试失败的任务，提高执行成功率

## V2.0 新增功能

### 新增工具
- **🌐 翻译工具**：支持中英日韩等多语言互译
- **📝 摘要工具**：自动生成文本摘要、提取关键词、文本统计分析
- **❓ 问答工具**：编程、AI、数学等领域的知识查询

### 功能增强
- **会话历史管理**：记录用户与Agent的对话历史，支持上下文理解
- **任务重试机制**：任务失败时自动重试，最多3次
- **增强的任务解析**：新增翻译、摘要、问答等任务模板支持

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    Web 交互界面 (Streamlit)              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │ 任务输入  │ │ 进度展示  │ │ 结果展示  │ │ 历史记录  │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                   Agent 核心引擎                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  任务解析器   │→│  工具匹配器   │→│  执行规划器   │  │
│  │ TaskParser   │  │KeywordMatcher│  │  TaskAgent   │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                      工具池模块                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐       │
│  │FileTool │ │DataTool │ │CodeTool │ │PaperTool│       │
│  │文件处理  │ │数据分析  │ │代码运行  │ │文献查询  │       │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘       │
│  ┌─────────────┐                                       │
│  │ScheduleTool │                                       │
│  │  日程管理    │                                       │
│  └─────────────┘                                       │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                    任务管理模块                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  任务存储     │  │  状态监控     │  │  结果导出     │  │
│  │ TaskStorage  │  │ TaskManager  │  │ TaskExporter │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 项目结构

```
智能Agent平台/
├── agent_core.py      # Agent 核心引擎模块（原创核心）
├── tool_pool.py       # 工具池模块（5个工具实现）
├── task_manager.py    # 任务管理模块
├── app.py             # Web 交互界面（Streamlit）
├── config.py          # 配置管理模块
├── utils.py           # 工具函数模块
├── requirements.txt   # 依赖清单
├── README.md          # 项目说明文档
├── data/              # 数据存储目录
│   ├── tasks.db       # 任务数据库
│   └── schedules.db   # 日程数据库
├── exports/           # 导出文件目录
└── uploads/           # 上传文件目录
```

## 快速开始

### 环境要求

- Python 3.9 或更高版本
- pip 包管理器

### 安装步骤

1. **克隆项目**
```bash
git clone <repository_url>
cd 智能Agent平台
```

2. **创建虚拟环境（推荐）**
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

3. **安装依赖**
```bash
pip install -r requirements.txt
```

4. **运行程序**
```bash
streamlit run app.py
```

5. **访问界面**

程序启动后，在浏览器中打开 `http://localhost:8501`

## 功能模块说明

### 1. Agent 核心引擎 (agent_core.py)

核心功能类和方法：

- **TaskAgent**: 主 Agent 类
  - `process_task()`: 处理用户任务的主入口
  - `_create_execution_plan()`: 创建执行计划
  - `_execute_plan()`: 执行任务计划
  - `_integrate_results()`: 整合执行结果

- **TaskParser**: 任务解析器
  - `parse_task()`: 解析自然语言任务
  - `_try_template_match()`: 模板匹配
  - `_split_by_separators()`: 分隔符拆分

- **KeywordMatcher**: 关键词匹配器
  - `match_tool()`: 匹配工具类型
  - `extract_action()`: 提取动作类型

### 2. 工具池模块 (tool_pool.py)

内置8个学生高频工具：

| 工具名称 | 类名 | 功能描述 |
|---------|------|---------|
| 文件处理 | FileTool | PDF文本/表格提取、PDF转Word |
| 数据分析 | DataTool | 数据读取、统计计算、图表生成 |
| 代码运行 | CodeTool | 安全沙箱运行Python代码 |
| 文献查询 | PaperTool | 本地文献库关键词搜索 |
| 日程管理 | ScheduleTool | 日程增删查改 |
| 文本翻译 | TranslateTool | 多语言文本翻译（中英互译） |
| 文本摘要 | SummaryTool | 文本摘要、关键词提取、统计分析 |
| 知识问答 | QATool | 编程、AI、数学等领域知识查询 |

**统一调用接口**：
```python
tool_manager.run_tool(tool_name: str, params: dict) -> dict
```

### 3. 任务管理模块 (task_manager.py)

- **TaskManager**: 任务管理器
- **TaskStorage**: 任务存储（SQLite）
- **TaskExporter**: 结果导出（Markdown/Excel）

### 4. Web 界面模块 (app.py)

基于 Streamlit 实现，包括：
- 任务输入区（文本+文件上传）
- 工具开关面板
- 执行进度展示
- 结果展示区
- 历史任务列表

## 测试示例

### 示例1：PDF表格提取并计算

**输入**：
```
提取test.pdf中的表格并计算均值
```

**预期输出**：
```
任务执行完成，共处理 2 个步骤：

✓ 步骤1: 提取test.pdf中的表格
   结果: 成功提取1个表格，包含4行数据

✓ 步骤2: 计算均值
   结果: 均值计算完成，数值列均值为 170.0
```

### 示例2：数据可视化

**输入**：
```
读取data.csv数据并画柱状图
```

**预期输出**：
```
任务执行完成，共处理 2 个步骤：

✓ 步骤1: 读取data.csv数据
   结果: 成功读取数据，共5行4列

✓ 步骤2: 画柱状图
   结果: 柱状图生成成功，保存至 chart_output.png
```

### 示例3：文献搜索

**输入**：
```
搜索机器学习相关文献
```

**预期输出**：
```
任务执行完成，共处理 1 个步骤：

✓ 步骤1: 搜索机器学习相关文献
   结果: 找到3篇相关文献：
   - 基于机器学习的图像识别方法研究
   - 深度学习在自然语言处理中的应用综述
   - 大数据分析技术在教育领域的应用
```

## 核心算法说明

### 任务解析算法

```python
def parse_task(task_text):
    """
    任务解析核心算法

    步骤：
    1. 预处理文本（去除多余空白、统一标点）
    2. 尝试模板匹配（使用预定义的任务模板）
    3. 分隔符拆分（识别"然后"、"并且"等连接词）
    4. 关键词匹配（为每个子任务匹配合适的工具）
    5. 参数提取（从文本中提取文件名、日期等参数）
    """
```

### 工具匹配算法

```python
def match_tool(text):
    """
    工具匹配核心算法

    采用加权评分机制：
    - 主关键词匹配：权重 2.0
    - 次关键词匹配：权重 1.0
    - 工具类型权重：0.7-1.0

    返回得分最高的工具及置信度
    """
```

## 扩展开发

### 添加新工具

1. 在 `tool_pool.py` 中创建新工具类，继承 `BaseTool`
2. 实现 `execute()` 方法
3. 在 `ToolManager._init_tools()` 中注册新工具
4. 在 `agent_core.py` 的 `KeywordMatcher.TOOL_KEYWORDS` 中添加关键词映射

### 示例：添加翻译工具

```python
class TranslateTool(BaseTool):
    def __init__(self):
        super().__init__(
            name="translate_tool",
            description="文本翻译工具"
        )
        self.supported_actions = ["translate"]

    def execute(self, params: Dict[str, Any]) -> Dict[str, Any]:
        # 实现翻译逻辑
        pass
```

## 注意事项

1. **代码运行安全**：CodeTool 使用沙箱模式，禁止危险操作
2. **文献查询**：PaperTool 为模拟接口，不实际连接付费数据库
3. **数据存储**：所有数据本地存储，无需网络连接
4. **文件上传**：支持的文件类型在 `config.py` 中配置

## 软著说明

本项目为原创开发，核心原创代码主要集中在：
- `agent_core.py`：任务解析和工具匹配的原创算法
- `tool_pool.py`：工具封装和统一调用接口

代码结构清晰，注释完整，便于软著申请时提取代码页。

## 技术栈

- **核心语言**：Python 3.9+
- **Web框架**：Streamlit
- **数据库**：SQLite
- **数据处理**：Pandas, NumPy
- **可视化**：Matplotlib
- **文件处理**：PyPDF2, pdfplumber, python-docx

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 项目Issues
- 邮件联系2317583998@qq.com

---

**版本**：V2.0.0
**更新时间**：2026年
